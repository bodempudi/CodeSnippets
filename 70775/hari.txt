Derived Sales :=
VAR _HasOneMonth = HASONEVALUE(salesdata[MO])

-- Row logic (scoped to current Category–Description–Year)
VAR _Cat  = SELECTEDVALUE(salesdata[Category])
VAR _Desc = SELECTEDVALUE(salesdata[Description])
VAR _Yr   = SELECTEDVALUE(salesdata[YR])

VAR _Target =
    CALCULATE(
        MAX(salesdata[TotalForecast]),
        FILTER(ALL(salesdata),
            salesdata[Category]=_Cat &&
            salesdata[Description]=_Desc &&
            salesdata[YR]=_Yr
        )
    )

VAR _ActualYear =
    CALCULATE(
        SUM(salesdata[Actual]),
        FILTER(ALL(salesdata),
            salesdata[Category]=_Cat &&
            salesdata[Description]=_Desc &&
            salesdata[YR]=_Yr
        )
    )

VAR _WD_Zero_Total =
    CALCULATE(
        SUM(salesdata[MonthWorkingDays]),
        FILTER(ALL(salesdata),
            salesdata[Category]=_Cat &&
            salesdata[Description]=_Desc &&
            salesdata[YR]=_Yr &&
            COALESCE(salesdata[Actual],0)=0
        )
    )

VAR _Leftover = _Target - _ActualYear
VAR _SalesThisMonth = SUM(salesdata[Actual])
VAR _WD_ThisMonth   = MAX(salesdata[MonthWorkingDays])

VAR _RowValue =
    IF(
        _SalesThisMonth > 0,
        _SalesThisMonth,
        DIVIDE(_Leftover * _WD_ThisMonth, _WD_Zero_Total, 0)
    )

RETURN
IF(
    _HasOneMonth,
    -- row level
    _RowValue,
    -- totals: explicitly sum month rows in current filters
    SUMX(
        SUMMARIZE(
            ALLSELECTED(salesdata),
            salesdata[Category],
            salesdata[Description],
            salesdata[YR],
            salesdata[MO]
        ),
        CALCULATE([Derived Sales])   -- evaluates this measure per-month context
    )
)
