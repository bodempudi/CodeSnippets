Derived Sales :=
VAR _HasOneMonth = HASONEVALUE(SalesByMonth[MO])

-- Row logic (scoped to current Category–Description–Year)
VAR _Cat  = SELECTEDVALUE(SalesByMonth[Category])
VAR _Desc = SELECTEDVALUE(SalesByMonth[Description])
VAR _Yr   = SELECTEDVALUE(SalesByMonth[YR])

VAR _Target =
    CALCULATE(
        MAX(SalesByMonth[TotalForecast]),
        FILTER(ALL(SalesByMonth),
            SalesByMonth[Category]=_Cat &&
            SalesByMonth[Description]=_Desc &&
            SalesByMonth[YR]=_Yr
        )
    )

VAR _ActualYear =
    CALCULATE(
        SUM(SalesByMonth[Actual]),
        FILTER(ALL(SalesByMonth),
            SalesByMonth[Category]=_Cat &&
            SalesByMonth[Description]=_Desc &&
            SalesByMonth[YR]=_Yr
        )
    )

VAR _WD_Zero_Total =
    CALCULATE(
        SUM(SalesByMonth[MonthWorkingDays]),
        FILTER(ALL(SalesByMonth),
            SalesByMonth[Category]=_Cat &&
            SalesByMonth[Description]=_Desc &&
            SalesByMonth[YR]=_Yr &&
            COALESCE(SalesByMonth[Actual],0)=0
        )
    )

VAR _Leftover = _Target - _ActualYear
VAR _SalesThisMonth = SUM(SalesByMonth[Actual])
VAR _WD_ThisMonth   = MAX(SalesByMonth[MonthWorkingDays])

VAR _RowValue =
    IF(
        _SalesThisMonth > 0,
        _SalesThisMonth,
        DIVIDE(_Leftover * _WD_ThisMonth, _WD_Zero_Total, 0)
    )

RETURN
IF(
    _HasOneMonth,
    -- row level
    _RowValue,
    -- totals: explicitly sum month rows in current filte
